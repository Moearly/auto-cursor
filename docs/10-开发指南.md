# 10 - å¼€å‘æŒ‡å—

## ğŸ“‹ å¼€å‘è§„èŒƒ

æœ¬æ–‡æ¡£ä»‹ç» Auto-Cursor é¡¹ç›®çš„å¼€å‘è§„èŒƒã€æœ€ä½³å®è·µå’Œè´¡çŒ®æŒ‡å—ã€‚

## ğŸ¯ ä»£ç è§„èŒƒ

### 1. Rust ä»£ç è§„èŒƒ

#### å‘½åè§„èŒƒ
```rust
// æ¨¡å—åï¼šå°å†™è›‡å½¢å‘½å
mod machine_id;
mod account_manager;

// ç»“æ„ä½“ï¼šå¤§é©¼å³°å‘½å
struct MachineIdRestorer;
struct AccountInfo;

// å‡½æ•°ï¼šå°å†™è›‡å½¢å‘½å
fn generate_new_machine_ids() -> Result<MachineIds>;
fn switch_account_with_token() -> Result<SwitchAccountResult>;

// å¸¸é‡ï¼šå¤§å†™è›‡å½¢å‘½å
const MAX_RETRY_COUNT: u32 = 3;
const DEFAULT_TIMEOUT: Duration = Duration::from_secs(30);

// æšä¸¾ï¼šå¤§é©¼å³°å‘½å
enum AuthType {
    Auth0,
    Google,
    GitHub,
}
```

#### ä»£ç æ ¼å¼åŒ–
```bash
# ä½¿ç”¨ rustfmt æ ¼å¼åŒ–ä»£ç 
cargo fmt

# æ£€æŸ¥æ ¼å¼
cargo fmt -- --check

# é…ç½® rustfmt.toml
max_width = 100
tab_spaces = 4
edition = "2024"
```

#### ä»£ç æ£€æŸ¥
```bash
# ä½¿ç”¨ clippy æ£€æŸ¥ä»£ç è´¨é‡
cargo clippy

# ä¸¥æ ¼æ¨¡å¼
cargo clippy -- -D warnings

# ä¿®å¤å¯è‡ªåŠ¨ä¿®å¤çš„é—®é¢˜
cargo clippy --fix
```

#### æ–‡æ¡£æ³¨é‡Š
```rust
/// ç”Ÿæˆæ–°çš„æœºå™¨ID
///
/// # Returns
///
/// è¿”å›åŒ…å«æ‰€æœ‰æœºå™¨IDçš„ç»“æ„ä½“
///
/// # Errors
///
/// å¦‚æœç”Ÿæˆéšæœºæ•°å¤±è´¥ï¼Œè¿”å›é”™è¯¯
///
/// # Examples
///
/// ```
/// let restorer = MachineIdRestorer::new()?;
/// let ids = restorer.generate_new_machine_ids()?;
/// println!("Generated ID: {}", ids.dev_device_id);
/// ```
pub fn generate_new_machine_ids(&self) -> Result<MachineIds> {
    // å®ç°
}
```

### 2. TypeScript ä»£ç è§„èŒƒ

#### å‘½åè§„èŒƒ
```typescript
// æ¥å£ï¼šå¤§é©¼å³°å‘½åï¼ŒI å‰ç¼€ï¼ˆå¯é€‰ï¼‰
interface UserAuthInfo {
  isAuthorized: boolean;
  tokenLength: number;
}

// ç±»å‹åˆ«åï¼šå¤§é©¼å³°å‘½å
type UpdateInfo = {
  hasUpdate: boolean;
  version: string;
};

// ç±»ï¼šå¤§é©¼å³°å‘½å
class CursorService {
  // ...
}

// å‡½æ•°ï¼šå°é©¼å³°å‘½å
function checkCursorInstallation(): Promise<boolean> {
  // ...
}

// å¸¸é‡ï¼šå¤§å†™è›‡å½¢å‘½å
const MAX_RETRY_COUNT = 3;
const DEFAULT_TIMEOUT = 30000;

// å˜é‡ï¼šå°é©¼å³°å‘½å
const authInfo = await checkAuth();
const usageData = await getUsageStats();
```

#### ä»£ç æ ¼å¼åŒ–
```bash
# ä½¿ç”¨ prettier æ ¼å¼åŒ–
npx prettier --write "src/**/*.{ts,tsx}"

# é…ç½® .prettierrc
{
  "semi": true,
  "trailingComma": "es5",
  "singleQuote": false,
  "printWidth": 100,
  "tabWidth": 2
}
```

#### ESLint é…ç½®
```json
{
  "extends": [
    "eslint:recommended",
    "plugin:@typescript-eslint/recommended",
    "plugin:react/recommended",
    "plugin:react-hooks/recommended"
  ],
  "rules": {
    "no-console": "warn",
    "@typescript-eslint/explicit-module-boundary-types": "off",
    "react/react-in-jsx-scope": "off"
  }
}
```

### 3. Git æäº¤è§„èŒƒ

#### Commit Message æ ¼å¼
```
<type>(<scope>): <subject>

<body>

<footer>
```

#### Type ç±»å‹
- `feat`: æ–°åŠŸèƒ½
- `fix`: ä¿®å¤bug
- `docs`: æ–‡æ¡£æ›´æ–°
- `style`: ä»£ç æ ¼å¼è°ƒæ•´
- `refactor`: é‡æ„
- `perf`: æ€§èƒ½ä¼˜åŒ–
- `test`: æµ‹è¯•ç›¸å…³
- `chore`: æ„å»º/å·¥å…·ç›¸å…³

#### ç¤ºä¾‹
```bash
# æ–°åŠŸèƒ½
git commit -m "feat(auth): æ·»åŠ å¿«é€Ÿåˆ‡æ¢è´¦å·åŠŸèƒ½"

# ä¿®å¤bug
git commit -m "fix(machine-id): ä¿®å¤Windowsè·¯å¾„è¯†åˆ«é—®é¢˜"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs: æ›´æ–°éƒ¨ç½²æŒ‡å—"

# é‡æ„
git commit -m "refactor(account): ä¼˜åŒ–è´¦å·åˆ‡æ¢é€»è¾‘"
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

### æ·»åŠ æ–°åŠŸèƒ½

#### 1. åç«¯æ–°å¢ Tauri å‘½ä»¤

```rust
// 1. åœ¨å¯¹åº”æ¨¡å—ä¸­å®ç°åŠŸèƒ½
// src-tauri/src/new_feature.rs
pub fn new_feature_function(param: String) -> Result<String> {
    // å®ç°é€»è¾‘
    Ok("success".to_string())
}

// 2. åœ¨ lib.rs ä¸­åˆ›å»º Tauri å‘½ä»¤
#[tauri::command]
async fn new_feature_command(param: String) -> Result<String, String> {
    new_feature_function(param)
        .map_err(|e| e.to_string())
}

// 3. æ³¨å†Œå‘½ä»¤
pub fn run() {
    tauri::Builder::default()
        .invoke_handler(tauri::generate_handler![
            // ... å…¶ä»–å‘½ä»¤
            new_feature_command,  // æ·»åŠ æ–°å‘½ä»¤
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

#### 2. å‰ç«¯è°ƒç”¨æ–°å‘½ä»¤

```typescript
// 1. åœ¨ services ä¸­åˆ›å»ºæœåŠ¡æ–¹æ³•
// src/services/newFeatureService.ts
import { invoke } from '@tauri-apps/api/core';

export class NewFeatureService {
  static async callNewFeature(param: string): Promise<string> {
    return await invoke<string>('new_feature_command', { param });
  }
}

// 2. åœ¨ç»„ä»¶ä¸­ä½¿ç”¨
import { NewFeatureService } from '../services/newFeatureService';

const handleClick = async () => {
  try {
    const result = await NewFeatureService.callNewFeature('test');
    console.log('ç»“æœ:', result);
  } catch (error) {
    console.error('é”™è¯¯:', error);
  }
};
```

#### 3. æ·»åŠ æ–°é¡µé¢

```typescript
// 1. åˆ›å»ºé¡µé¢ç»„ä»¶
// src/pages/NewFeaturePage.tsx
import React, { useState } from 'react';

export const NewFeaturePage: React.FC = () => {
  const [data, setData] = useState<string>('');

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">æ–°åŠŸèƒ½</h1>
      {/* é¡µé¢å†…å®¹ */}
    </div>
  );
};

// 2. åœ¨ App.tsx ä¸­æ·»åŠ è·¯ç”±
import { NewFeaturePage } from './pages/NewFeaturePage';

<Routes>
  {/* ... å…¶ä»–è·¯ç”± */}
  <Route path="/new-feature" element={<NewFeaturePage />} />
</Routes>

// 3. åœ¨ Layout.tsx ä¸­æ·»åŠ å¯¼èˆª
const navItems = [
  // ... å…¶ä»–å¯¼èˆª
  { path: '/new-feature', label: 'æ–°åŠŸèƒ½', icon: 'ğŸ†•' },
];
```

## ğŸ§ª æµ‹è¯•

### 1. Rust å•å…ƒæµ‹è¯•

```rust
#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_generate_machine_ids() {
        let restorer = MachineIdRestorer::new().unwrap();
        let ids = restorer.generate_new_machine_ids().unwrap();
        
        // éªŒè¯ UUID æ ¼å¼
        assert!(ids.dev_device_id.contains('-'));
        assert_eq!(ids.dev_device_id.len(), 36);
        
        // éªŒè¯ SHA256 é•¿åº¦
        assert_eq!(ids.machine_id.len(), 64);
        
        // éªŒè¯ SHA512 é•¿åº¦
        assert_eq!(ids.mac_machine_id.len(), 128);
    }

    #[test]
    fn test_token_processing() {
        let token = "user_01XXX%3A%3AeyJhbGci...";
        let processed = process_token(token);
        assert!(processed.starts_with("eyJhbGci"));
    }
}
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test

# è¿è¡Œç‰¹å®šæµ‹è¯•
cargo test test_generate_machine_ids

# æ˜¾ç¤ºè¾“å‡º
cargo test -- --nocapture
```

### 2. TypeScript æµ‹è¯•

```typescript
// ä½¿ç”¨ Vitest
import { describe, it, expect } from 'vitest';
import { CursorService } from '../services/cursorService';

describe('CursorService', () => {
  it('should check cursor installation', async () => {
    const result = await CursorService.checkCursorInstallation();
    expect(typeof result).toBe('boolean');
  });

  it('should get cursor paths', async () => {
    const paths = await CursorService.getCursorPaths();
    expect(Array.isArray(paths)).toBe(true);
    expect(paths.length).toBe(2);
  });
});
```

è¿è¡Œæµ‹è¯•ï¼š
```bash
# è¿è¡Œæµ‹è¯•
pnpm test

# ç›‘å¬æ¨¡å¼
pnpm test:watch

# è¦†ç›–ç‡
pnpm test:coverage
```

## ğŸ”§ è°ƒè¯•æŠ€å·§

### 1. Rust è°ƒè¯•

#### ä½¿ç”¨ println! è°ƒè¯•
```rust
fn debug_function() {
    println!("è°ƒè¯•ä¿¡æ¯: {:?}", some_variable);
    eprintln!("é”™è¯¯ä¿¡æ¯: {:?}", error);
}
```

#### ä½¿ç”¨æ—¥å¿—å®
```rust
use crate::{log_info, log_debug, log_error};

fn function_with_logging() {
    log_info!("å¼€å§‹æ‰§è¡Œ");
    log_debug!("å˜é‡å€¼: {:?}", variable);
    log_error!("å‘ç”Ÿé”™è¯¯: {}", error);
}
```

#### ä½¿ç”¨ dbg! å®
```rust
fn debug_with_dbg() {
    let result = dbg!(complex_calculation());
    dbg!(&some_struct);
}
```

### 2. TypeScript è°ƒè¯•

#### æµè§ˆå™¨å¼€å‘è€…å·¥å…·
```typescript
// åœ¨ä»£ç ä¸­è®¾ç½®æ–­ç‚¹
debugger;

// ä½¿ç”¨ console
console.log('æ™®é€šæ—¥å¿—');
console.error('é”™è¯¯æ—¥å¿—');
console.table(arrayData);
console.group('åˆ†ç»„æ—¥å¿—');
console.groupEnd();
```

#### VS Code è°ƒè¯•é…ç½®
```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "launch",
      "name": "Tauri Dev",
      "runtimeExecutable": "pnpm",
      "runtimeArgs": ["tauri", "dev"],
      "console": "integratedTerminal"
    }
  ]
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. Rust æ€§èƒ½ä¼˜åŒ–

#### ä½¿ç”¨ Release æ¨¡å¼
```bash
# å¼€å‘æ¨¡å¼ï¼ˆæ…¢ä½†æœ‰è°ƒè¯•ä¿¡æ¯ï¼‰
cargo build

# Release æ¨¡å¼ï¼ˆå¿«ä½†æ— è°ƒè¯•ä¿¡æ¯ï¼‰
cargo build --release
```

#### æ€§èƒ½åˆ†æ
```bash
# ä½¿ç”¨ cargo-flamegraph
cargo install flamegraph
cargo flamegraph --bin auto-cursor

# ä½¿ç”¨ perf (Linux)
perf record --call-graph dwarf ./target/release/auto-cursor
perf report
```

#### é¿å…ä¸å¿…è¦çš„å…‹éš†
```rust
// ä¸å¥½
fn process(data: String) {
    // data è¢«ç§»åŠ¨
}
let s = String::from("test");
process(s.clone());  // ä¸å¿…è¦çš„å…‹éš†

// å¥½
fn process(data: &str) {
    // å€Ÿç”¨
}
let s = String::from("test");
process(&s);  // å€Ÿç”¨ï¼Œæ— å…‹éš†
```

### 2. TypeScript æ€§èƒ½ä¼˜åŒ–

#### ä½¿ç”¨ React.memo
```typescript
const ExpensiveComponent = React.memo(({ data }) => {
  // åªåœ¨ data æ”¹å˜æ—¶é‡æ–°æ¸²æŸ“
  return <div>{data}</div>;
});
```

#### ä½¿ç”¨ useMemo å’Œ useCallback
```typescript
const MemoizedComponent: React.FC = () => {
  // ç¼“å­˜è®¡ç®—ç»“æœ
  const expensiveValue = useMemo(() => {
    return computeExpensiveValue(a, b);
  }, [a, b]);

  // ç¼“å­˜å‡½æ•°
  const handleClick = useCallback(() => {
    doSomething(a);
  }, [a]);

  return <div onClick={handleClick}>{expensiveValue}</div>;
};
```

#### è™šæ‹Ÿæ»šåŠ¨
```typescript
import { FixedSizeList } from 'react-window';

<FixedSizeList
  height={600}
  itemCount={1000}
  itemSize={50}
  width="100%"
>
  {({ index, style }) => (
    <div style={style}>Item {index}</div>
  )}
</FixedSizeList>
```

## ğŸ” å®‰å…¨æœ€ä½³å®è·µ

### 1. è¾“å…¥éªŒè¯

```rust
// Rust ç«¯éªŒè¯
fn validate_email(email: &str) -> Result<()> {
    let email_regex = Regex::new(r"^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$")?;
    if !email_regex.is_match(email) {
        return Err(anyhow!("æ— æ•ˆçš„é‚®ç®±åœ°å€"));
    }
    Ok(())
}

fn validate_token(token: &str) -> Result<()> {
    if token.len() < 100 {
        return Err(anyhow!("Tokené•¿åº¦ä¸è¶³"));
    }
    if !token.starts_with("eyJ") {
        return Err(anyhow!("æ— æ•ˆçš„Tokenæ ¼å¼"));
    }
    Ok(())
}
```

```typescript
// TypeScript ç«¯éªŒè¯
function validateEmail(email: string): boolean {
  const regex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
  return regex.test(email);
}

function validateToken(token: string): boolean {
  return token.length >= 100 && token.startsWith('eyJ');
}
```

### 2. é”™è¯¯å¤„ç†

```rust
// ä¸è¦æš´éœ²æ•æ„Ÿä¿¡æ¯
fn handle_error(error: Error) -> String {
    // ä¸å¥½ï¼šæš´éœ²å†…éƒ¨è·¯å¾„
    format!("Error: {}", error)
    
    // å¥½ï¼šé€šç”¨é”™è¯¯ä¿¡æ¯
    "æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•".to_string()
}
```

### 3. æƒé™æ£€æŸ¥

```rust
fn require_admin() -> Result<()> {
    #[cfg(target_os = "windows")]
    {
        if !is_elevated() {
            return Err(anyhow!("éœ€è¦ç®¡ç†å‘˜æƒé™"));
        }
    }
    Ok(())
}
```

## ğŸ“ æ–‡æ¡£ç¼–å†™

### 1. ä»£ç æ³¨é‡Š

```rust
// å•è¡Œæ³¨é‡Šï¼šè§£é‡Šä¸ºä»€ä¹ˆè¿™æ ·åš
// ä½¿ç”¨ %3A%3A åˆ†éš”ç¬¦æ˜¯å› ä¸º Cursor API è¿”å›çš„æ ¼å¼

/// æ–‡æ¡£æ³¨é‡Šï¼šè§£é‡Šå‡½æ•°çš„ä½œç”¨
/// 
/// è¿™ä¸ªå‡½æ•°ä¼šå¤„ç† Token å­—ç¬¦ä¸²ï¼Œç§»é™¤ç”¨æˆ·IDå‰ç¼€
```

### 2. README æ›´æ–°

æ¯æ¬¡æ·»åŠ æ–°åŠŸèƒ½æ—¶ï¼Œæ›´æ–° README.mdï¼š
- åŠŸèƒ½åˆ—è¡¨
- ä½¿ç”¨ç¤ºä¾‹
- é…ç½®è¯´æ˜

### 3. å˜æ›´æ—¥å¿—

ç»´æŠ¤ CHANGELOG.mdï¼š
```markdown
## [0.8.0] - 2025-10-28

### Added
- æ·»åŠ å¿«é€Ÿåˆ‡æ¢è´¦å·åŠŸèƒ½
- æ”¯æŒæ‰¹é‡æ³¨å†Œ

### Fixed
- ä¿®å¤ Windows è·¯å¾„è¯†åˆ«é—®é¢˜
- ä¿®å¤ Token æ ¼å¼å¤„ç†bug

### Changed
- ä¼˜åŒ–è´¦å·åˆ‡æ¢æµç¨‹
- æ”¹è¿›é”™è¯¯æç¤ºä¿¡æ¯
```

## ğŸ¤ è´¡çŒ®æµç¨‹

### 1. Fork é¡¹ç›®

```bash
# Fork é¡¹ç›®åˆ°ä½ çš„è´¦å·
# å…‹éš†ä½ çš„ fork
git clone https://github.com/your-username/auto-cursor.git
cd auto-cursor

# æ·»åŠ ä¸Šæ¸¸ä»“åº“
git remote add upstream https://github.com/original/auto-cursor.git
```

### 2. åˆ›å»ºåˆ†æ”¯

```bash
# åˆ›å»ºåŠŸèƒ½åˆ†æ”¯
git checkout -b feature/new-feature

# æˆ–ä¿®å¤åˆ†æ”¯
git checkout -b fix/bug-description
```

### 3. å¼€å‘å’Œæµ‹è¯•

```bash
# å¼€å‘åŠŸèƒ½
# ç¼–å†™ä»£ç ...

# è¿è¡Œæµ‹è¯•
cargo test
pnpm test

# æ ¼å¼åŒ–ä»£ç 
cargo fmt
npx prettier --write "src/**/*.{ts,tsx}"

# ä»£ç æ£€æŸ¥
cargo clippy
pnpm lint
```

### 4. æäº¤æ›´æ”¹

```bash
# æ·»åŠ æ›´æ”¹
git add .

# æäº¤ï¼ˆéµå¾ªæäº¤è§„èŒƒï¼‰
git commit -m "feat: æ·»åŠ æ–°åŠŸèƒ½"

# æ¨é€åˆ°ä½ çš„ fork
git push origin feature/new-feature
```

### 5. åˆ›å»º Pull Request

1. åœ¨ GitHub ä¸Šæ‰“å¼€ä½ çš„ fork
2. ç‚¹å‡» "New Pull Request"
3. å¡«å†™ PR æè¿°ï¼š
   - åŠŸèƒ½è¯´æ˜
   - æµ‹è¯•æƒ…å†µ
   - ç›¸å…³ Issue

### 6. ä»£ç å®¡æŸ¥

- å“åº”å®¡æŸ¥æ„è§
- è¿›è¡Œå¿…è¦çš„ä¿®æ”¹
- æ›´æ–° PR

## ğŸ“‹ æ£€æŸ¥æ¸…å•

### å¼€å‘å‰
- [ ] äº†è§£é¡¹ç›®ç»“æ„
- [ ] é˜…è¯»ç›¸å…³æ–‡æ¡£
- [ ] é…ç½®å¼€å‘ç¯å¢ƒ
- [ ] è¿è¡Œé¡¹ç›®ç¡®ä¿æ­£å¸¸

### å¼€å‘ä¸­
- [ ] éµå¾ªä»£ç è§„èŒƒ
- [ ] ç¼–å†™æ¸…æ™°çš„æ³¨é‡Š
- [ ] å®ç°åŠŸèƒ½é€»è¾‘
- [ ] å¤„ç†é”™è¯¯æƒ…å†µ
- [ ] ç¼–å†™å•å…ƒæµ‹è¯•

### æäº¤å‰
- [ ] è¿è¡Œæ‰€æœ‰æµ‹è¯•
- [ ] æ ¼å¼åŒ–ä»£ç 
- [ ] ä»£ç æ£€æŸ¥é€šè¿‡
- [ ] æ›´æ–°æ–‡æ¡£
- [ ] ç¼–å†™æäº¤ä¿¡æ¯

### PR å‰
- [ ] åŒæ­¥ä¸Šæ¸¸æ›´æ–°
- [ ] è§£å†³å†²çª
- [ ] æœ¬åœ°æµ‹è¯•é€šè¿‡
- [ ] å¡«å†™ PR æè¿°
- [ ] å…³è”ç›¸å…³ Issue

## ğŸ”— æœ‰ç”¨çš„èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Tauri æ–‡æ¡£](https://tauri.app/)
- [Rust æ–‡æ¡£](https://doc.rust-lang.org/)
- [React æ–‡æ¡£](https://react.dev/)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/)

### å­¦ä¹ èµ„æº
- [Rust Book](https://doc.rust-lang.org/book/)
- [Tauri ç¤ºä¾‹](https://github.com/tauri-apps/tauri/tree/dev/examples)
- [React æ•™ç¨‹](https://react.dev/learn)

### å·¥å…·
- [Rust Playground](https://play.rust-lang.org/)
- [TypeScript Playground](https://www.typescriptlang.org/play)
- [Regex101](https://regex101.com/)

---

**æœ€åæ›´æ–°**ï¼š2025-10-28
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0

