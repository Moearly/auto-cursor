# 02 - æŠ€æœ¯æ¶æ„

## ğŸ—ï¸ æ•´ä½“æ¶æ„

Auto-Cursor é‡‡ç”¨æ··åˆæ¶æ„è®¾è®¡ï¼Œç»“åˆäº† Rustã€TypeScript å’Œ Python ä¸‰ç§è¯­è¨€çš„ä¼˜åŠ¿ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·ç•Œé¢å±‚ (UI)                        â”‚
â”‚              React + TypeScript + Tailwind              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Tauri IPC
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Tauri å‘½ä»¤å±‚ (Commands)                 â”‚
â”‚                    Rust + Tauri 2.0                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æœºå™¨IDç®¡ç†    â”‚  â”‚  è´¦å·ç®¡ç†     â”‚  â”‚  è®¤è¯æ£€æŸ¥     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  æ—¥å¿—ç³»ç»Ÿ     â”‚  â”‚ Pythoné›†æˆ   â”‚  â”‚  æ–‡ä»¶æ“ä½œ     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SQLiteæ•°æ®åº“  â”‚ â”‚æ–‡ä»¶ç³»ç»Ÿâ”‚ â”‚ Pythonè„šæœ¬æ‰§è¡Œ  â”‚
â”‚ (state.vscdb)â”‚ â”‚(JSON)  â”‚ â”‚ (è‡ªåŠ¨åŒ–æ³¨å†Œ)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“š æŠ€æœ¯æ ˆè¯¦è§£

### 1. å‰ç«¯æŠ€æœ¯æ ˆ

#### React 19.1.0
- **ç”¨é€”**ï¼šæ„å»ºç”¨æˆ·ç•Œé¢
- **ç‰¹ç‚¹**ï¼šæœ€æ–°ç‰ˆæœ¬ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œå¹¶å‘ç‰¹æ€§
- **ç»„ä»¶è®¾è®¡**ï¼šå‡½æ•°å¼ç»„ä»¶ + Hooks

#### TypeScript 5.8.3
- **ç”¨é€”**ï¼šç±»å‹å®‰å…¨çš„JavaScript
- **é…ç½®**ï¼šä¸¥æ ¼æ¨¡å¼ï¼Œå®Œæ•´ç±»å‹æ£€æŸ¥
- **ä¼˜åŠ¿**ï¼šç¼–è¯‘æ—¶é”™è¯¯æ£€æµ‹ï¼Œæ›´å¥½çš„IDEæ”¯æŒ

#### React Router DOM 7.8.2
- **ç”¨é€”**ï¼šå‰ç«¯è·¯ç”±ç®¡ç†
- **è·¯ç”±åˆ—è¡¨**ï¼š
  - `/` - é¦–é¡µ
  - `/machine-id` - æœºå™¨IDç®¡ç†
  - `/auth-check` - è®¤è¯æ£€æŸ¥
  - `/token-manage` - Tokenç®¡ç†
  - `/auto-register` - è‡ªåŠ¨æ³¨å†Œ
  - `/virtual-card` - è™šæ‹Ÿå¡ç”Ÿæˆ

#### Tailwind CSS 3.4.6
- **ç”¨é€”**ï¼šåŸå­åŒ–CSSæ¡†æ¶
- **é…ç½®**ï¼šè‡ªå®šä¹‰ä¸»é¢˜ï¼Œå“åº”å¼è®¾è®¡
- **ä¼˜åŠ¿**ï¼šå¿«é€Ÿå¼€å‘ï¼Œä¸€è‡´çš„è®¾è®¡ç³»ç»Ÿ

#### Vite 7.0.4
- **ç”¨é€”**ï¼šå‰ç«¯æ„å»ºå·¥å…·
- **ç‰¹ç‚¹**ï¼šæé€Ÿçƒ­æ›´æ–°ï¼Œä¼˜åŒ–çš„ç”Ÿäº§æ„å»º
- **æ’ä»¶**ï¼š@vitejs/plugin-react

### 2. åç«¯æŠ€æœ¯æ ˆ

#### Tauri 2.0
- **ç”¨é€”**ï¼šæ¡Œé¢åº”ç”¨æ¡†æ¶
- **ç‰¹ç‚¹**ï¼š
  - å°ä½“ç§¯ï¼ˆç›¸æ¯”Electronï¼‰
  - åŸç”Ÿæ€§èƒ½
  - å®‰å…¨çš„IPCé€šä¿¡
  - è·¨å¹³å°æ”¯æŒ

**Taurié…ç½®**ï¼š
```json
{
  "productName": "auto-cursor",
  "version": "0.8.0",
  "identifier": "com.zhuanz.auto-cursor",
  "build": {
    "beforeDevCommand": "pnpm dev",
    "devUrl": "http://localhost:1420",
    "beforeBuildCommand": "pnpm build",
    "frontendDist": "../dist"
  }
}
```

#### Rust (Edition 2024)
- **ç”¨é€”**ï¼šåç«¯æ ¸å¿ƒé€»è¾‘
- **ç‰¹ç‚¹**ï¼šå†…å­˜å®‰å…¨ï¼Œé«˜æ€§èƒ½ï¼Œé›¶æˆæœ¬æŠ½è±¡
- **ç¼–è¯‘ä¼˜åŒ–**ï¼š
  ```toml
  [profile.release]
  opt-level = "z"      # ä¼˜åŒ–å¤§å°
  lto = true           # é“¾æ¥æ—¶ä¼˜åŒ–
  codegen-units = 1    # å•ä¸€ä»£ç ç”Ÿæˆå•å…ƒ
  panic = "abort"      # ä½¿ç”¨abortå‡å°å¤§å°
  strip = true         # å»é™¤è°ƒè¯•ç¬¦å·
  ```

#### æ ¸å¿ƒä¾èµ–åº“

##### æ•°æ®åº“æ“ä½œ
```toml
rusqlite = { version = "0.29", features = ["bundled"] }
```
- **ç”¨é€”**ï¼šSQLiteæ•°æ®åº“æ“ä½œ
- **ç‰¹æ€§**ï¼šbundledæ¨¡å¼ï¼Œå†…ç½®SQLite

##### HTTPå®¢æˆ·ç«¯
```toml
reqwest = { version = "0.11", features = ["json", "gzip", "deflate", "brotli"] }
```
- **ç”¨é€”**ï¼šHTTPè¯·æ±‚
- **ç‰¹æ€§**ï¼šå¼‚æ­¥ï¼Œæ”¯æŒå¤šç§å‹ç¼©æ ¼å¼

##### åºåˆ—åŒ–
```toml
serde = { version = "1", features = ["derive"] }
serde_json = "1"
```
- **ç”¨é€”**ï¼šæ•°æ®åºåˆ—åŒ–/ååºåˆ—åŒ–
- **ç‰¹æ€§**ï¼šderiveå®ï¼ŒJSONæ”¯æŒ

##### å¼‚æ­¥è¿è¡Œæ—¶
```toml
tokio = { version = "1", features = ["full"] }
```
- **ç”¨é€”**ï¼šå¼‚æ­¥ä»»åŠ¡è°ƒåº¦
- **ç‰¹æ€§**ï¼šå®Œæ•´ç‰¹æ€§é›†

##### åŠ å¯†å’Œç¼–ç 
```toml
sha2 = "0.10"          # SHA256/SHA512å“ˆå¸Œ
base64 = "0.21"        # Base64ç¼–ç 
hex = "0.4"            # åå…­è¿›åˆ¶ç¼–ç 
uuid = { version = "1.0", features = ["v4"] }  # UUIDç”Ÿæˆ
```

##### å¹³å°ç‰¹å®šä¾èµ–
```toml
[target.'cfg(windows)'.dependencies]
winreg = "0.50"        # Windowsæ³¨å†Œè¡¨æ“ä½œ

[target.'cfg(target_os = "macos")'.dependencies]
plist = "1.4"          # macOS plistæ–‡ä»¶æ“ä½œ
```

### 3. Pythoné›†æˆ

#### ç”¨é€”
- æµè§ˆå™¨è‡ªåŠ¨åŒ–ï¼ˆSeleniumï¼‰
- å¤æ‚çš„æ³¨å†Œæµç¨‹å¤„ç†
- é‚®ç®±éªŒè¯ç è·å–

#### æ‰“åŒ…æ–¹å¼
```python
# ä½¿ç”¨PyInstalleræ‰“åŒ…ä¸ºç‹¬ç«‹å¯æ‰§è¡Œæ–‡ä»¶
pyinstaller --onefile \
  --add-data "cursor_register_manual.py:." \
  --add-data "new_signup.py:." \
  cursor_register_entry.py
```

#### é›†æˆæ–¹å¼
```rust
// Rustè°ƒç”¨Pythonå¯æ‰§è¡Œæ–‡ä»¶
let output = Command::new(&python_exe)
    .arg(&email)
    .arg(&first_name)
    .arg(&last_name)
    .stdout(Stdio::piped())
    .stderr(Stdio::piped())
    .spawn()?
    .wait_with_output()?;
```

## ğŸ”„ æ•°æ®æµæ¶æ„

### 1. å‰ç«¯åˆ°åç«¯é€šä¿¡

```typescript
// å‰ç«¯è°ƒç”¨Tauriå‘½ä»¤
import { invoke } from '@tauri-apps/api/core';

const result = await invoke('reset_machine_ids');
```

```rust
// åç«¯Tauriå‘½ä»¤
#[tauri::command]
async fn reset_machine_ids() -> Result<ResetResult, String> {
    let restorer = MachineIdRestorer::new()?;
    restorer.reset_machine_ids()
        .map_err(|e| e.to_string())
}
```

### 2. æ•°æ®æŒä¹…åŒ–

#### SQLiteæ•°æ®åº“
```
Cursor/User/globalStorage/state.vscdb
â”œâ”€â”€ ItemTable (é”®å€¼å¯¹å­˜å‚¨)
â”‚   â”œâ”€â”€ cursorAuth/accessToken
â”‚   â”œâ”€â”€ cursorAuth/refreshToken
â”‚   â”œâ”€â”€ cursorAuth/cachedEmail
â”‚   â””â”€â”€ cursorAuth/cachedSignUpType
```

#### JSONæ–‡ä»¶
```
Cursor/User/globalStorage/storage.json
{
  "telemetry.devDeviceId": "uuid",
  "telemetry.machineId": "sha256",
  "telemetry.macMachineId": "sha512",
  "telemetry.sqmId": "{UUID}",
  "storage.serviceMachineId": "uuid"
}
```

### 3. äº‹ä»¶ç³»ç»Ÿ

```typescript
// å‰ç«¯ç›‘å¬äº‹ä»¶
import { listen } from '@tauri-apps/api/event';

await listen('registration-output', (event) => {
  console.log('è¾“å‡º:', event.payload);
});
```

```rust
// åç«¯å‘é€äº‹ä»¶
app.emit("registration-output", payload)?;
```

## ğŸ—‚ï¸ æ¨¡å—æ¶æ„

### åç«¯æ¨¡å—ç»“æ„

```
src-tauri/src/
â”œâ”€â”€ main.rs                 # åº”ç”¨å…¥å£
â”œâ”€â”€ lib.rs                  # Tauriå‘½ä»¤æ³¨å†Œï¼ˆ37869è¡Œï¼‰
â”œâ”€â”€ machine_id.rs           # æœºå™¨IDç®¡ç†ï¼ˆ1694è¡Œï¼‰
â”œâ”€â”€ account_manager.rs      # è´¦å·ç®¡ç†ï¼ˆ1428è¡Œï¼‰
â”œâ”€â”€ auth_checker.rs         # è®¤è¯æ£€æŸ¥ï¼ˆ2061è¡Œï¼‰
â””â”€â”€ logger.rs               # æ—¥å¿—ç³»ç»Ÿ
```

#### lib.rs - å‘½ä»¤ä¸­å¿ƒ
```rust
#[cfg_attr(mobile, tauri::mobile_entry_point)]
pub fn run() {
    tauri::Builder::default()
        .plugin(tauri_plugin_opener::init())
        .plugin(tauri_plugin_fs::init())
        .plugin(tauri_plugin_dialog::init())
        .invoke_handler(tauri::generate_handler![
            // æœºå™¨IDç®¡ç†
            check_cursor_installation,
            get_cursor_paths,
            find_backups,
            extract_ids_from_backup,
            reset_machine_ids,
            complete_cursor_reset,
            
            // è´¦å·ç®¡ç†
            list_accounts,
            switch_account,
            switch_account_with_token,
            add_account,
            delete_account,
            logout_account,
            
            // è®¤è¯æ£€æŸ¥
            check_cursor_auth,
            get_usage_stats,
            get_aggregated_usage,
            
            // è‡ªåŠ¨æ³¨å†Œ
            register_cursor_account,
            register_cursor_account_with_config,
            
            // å…¶ä»–åŠŸèƒ½
            // ...
        ])
        .run(tauri::generate_context!())
        .expect("error while running tauri application");
}
```

### å‰ç«¯æ¨¡å—ç»“æ„

```
src/
â”œâ”€â”€ pages/                  # é¡µé¢ç»„ä»¶
â”‚   â”œâ”€â”€ HomePage.tsx
â”‚   â”œâ”€â”€ MachineIdPage.tsx
â”‚   â”œâ”€â”€ AuthCheckPage.tsx
â”‚   â”œâ”€â”€ TokenManagePage.tsx
â”‚   â”œâ”€â”€ AutoRegisterPage.tsx
â”‚   â””â”€â”€ VirtualCardGeneratorPage.tsx
â”‚
â”œâ”€â”€ components/             # UIç»„ä»¶
â”‚   â”œâ”€â”€ Layout.tsx
â”‚   â”œâ”€â”€ Button.tsx
â”‚   â”œâ”€â”€ LoadingSpinner.tsx
â”‚   â”œâ”€â”€ Toast.tsx
â”‚   â”œâ”€â”€ UpdateModal.tsx
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ services/               # æœåŠ¡å±‚
â”‚   â”œâ”€â”€ cursorService.ts
â”‚   â”œâ”€â”€ accountService.ts
â”‚   â”œâ”€â”€ analyticsService.ts
â”‚   â”œâ”€â”€ usageService.ts
â”‚   â””â”€â”€ updateService.ts
â”‚
â”œâ”€â”€ context/                # React Context
â”‚   â””â”€â”€ UsageContext.tsx
â”‚
â”œâ”€â”€ types/                  # TypeScriptç±»å‹
â”‚   â”œâ”€â”€ update.ts
â”‚   â”œâ”€â”€ bankCardConfig.ts
â”‚   â””â”€â”€ emailConfig.ts
â”‚
â””â”€â”€ utils/                  # å·¥å…·å‡½æ•°
    â””â”€â”€ cursorToken.ts
```

## ğŸ” å®‰å…¨æ¶æ„

### 1. æƒé™ç®¡ç†

#### Tauriæƒé™é…ç½®
```json
{
  "app": {
    "security": {
      "csp": null
    }
  }
}
```

### 2. æ•°æ®åŠ å¯†

#### Tokenå¤„ç†
```rust
// SHA256å“ˆå¸Œ
let mut hasher = Sha256::new();
hasher.update(data);
let result = hasher.finalize();

// Base64ç¼–ç 
let encoded = general_purpose::STANDARD.encode(data);
```

### 3. è¿›ç¨‹éš”ç¦»

```rust
// åˆ›å»ºéšè—çš„å­è¿›ç¨‹
fn create_hidden_command(program: &str) -> Command {
    #[cfg(target_os = "windows")]
    {
        let mut cmd = Command::new(program);
        cmd.creation_flags(CREATE_NO_WINDOW);
        cmd
    }
    
    #[cfg(not(target_os = "windows"))]
    {
        Command::new(program)
    }
}
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### 1. ç¼–è¯‘ä¼˜åŒ–
```toml
[profile.release]
opt-level = "z"           # æœ€å°åŒ–ä½“ç§¯
lto = true                # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1         # å•ä¸€ç¼–è¯‘å•å…ƒ
strip = true              # å»é™¤ç¬¦å·
```

### 2. å¼‚æ­¥å¤„ç†
```rust
// ä½¿ç”¨tokioå¼‚æ­¥è¿è¡Œæ—¶
#[tauri::command]
async fn async_operation() -> Result<String, String> {
    tokio::spawn(async move {
        // å¼‚æ­¥æ“ä½œ
    }).await
}
```

### 3. å‰ç«¯ä¼˜åŒ–
- ä»£ç åˆ†å‰²ï¼ˆReact.lazyï¼‰
- ç»„ä»¶æ‡’åŠ è½½
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆå¤§åˆ—è¡¨ï¼‰
- é˜²æŠ–å’ŒèŠ‚æµ

## ğŸ”§ æ„å»ºç³»ç»Ÿ

### Viteé…ç½®
```typescript
export default defineConfig({
  plugins: [react()],
  clearScreen: false,
  server: {
    port: 1420,
    strictPort: true,
  },
  build: {
    target: 'esnext',
    minify: 'esbuild',
  }
});
```

### Tauriæ„å»ºè„šæœ¬
```bash
# macOSé€šç”¨äºŒè¿›åˆ¶
tauri build --target universal-apple-darwin

# Intel Mac
tauri build --target x86_64-apple-darwin

# Apple Silicon
tauri build --target aarch64-apple-darwin
```

## ğŸ“¦ æ‰“åŒ…ç»“æ„

### åº”ç”¨åŒ…å†…å®¹
```
auto-cursor.app/
â”œâ”€â”€ Contents/
â”‚   â”œâ”€â”€ MacOS/
â”‚   â”‚   â””â”€â”€ auto-cursor          # ä¸»å¯æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ Resources/
â”‚   â”‚   â”œâ”€â”€ icons/               # åº”ç”¨å›¾æ ‡
â”‚   â”‚   â””â”€â”€ pyBuild/             # Pythonå¯æ‰§è¡Œæ–‡ä»¶
â”‚   â””â”€â”€ Info.plist               # åº”ç”¨ä¿¡æ¯
```

---

**æœ€åæ›´æ–°**ï¼š2025-10-28
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0

