# 09 - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è¿°

æœ¬æ–‡æ¡£ä»‹ç»å¦‚ä½•æ„å»ºå’Œéƒ¨ç½² Auto-Cursor åº”ç”¨åˆ°ä¸åŒå¹³å°ã€‚

## ğŸ› ï¸ å¼€å‘ç¯å¢ƒå‡†å¤‡

### 1. ç³»ç»Ÿè¦æ±‚

#### Windows
- Windows 10 æˆ–æ›´é«˜ç‰ˆæœ¬
- Visual Studio 2019 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆC++ æ„å»ºå·¥å…·ï¼‰
- Node.js 18+
- Rust 1.70+

#### macOS
- macOS 10.15 (Catalina) æˆ–æ›´é«˜ç‰ˆæœ¬
- Xcode Command Line Tools
- Node.js 18+
- Rust 1.70+

#### Linux
- Ubuntu 20.04 æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæˆ–å…¶ä»–ä¸»æµå‘è¡Œç‰ˆï¼‰
- æ„å»ºå·¥å…·ï¼šgcc, make, pkg-config
- Node.js 18+
- Rust 1.70+

### 2. å®‰è£…ä¾èµ–

#### å®‰è£… Node.js
```bash
# ä½¿ç”¨ nvm (æ¨è)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
nvm install 18
nvm use 18

# æˆ–ç›´æ¥ä¸‹è½½
# https://nodejs.org/
```

#### å®‰è£… Rust
```bash
# Unix/Linux/macOS
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# Windows
# ä¸‹è½½å¹¶è¿è¡Œ rustup-init.exe
# https://rustup.rs/
```

#### å®‰è£… pnpm
```bash
npm install -g pnpm
```

### 3. å…‹éš†é¡¹ç›®

```bash
git clone <repository-url>
cd auto-cursor
```

### 4. å®‰è£…é¡¹ç›®ä¾èµ–

```bash
# å®‰è£…å‰ç«¯ä¾èµ–
pnpm install

# Rust ä¾èµ–ä¼šåœ¨æ„å»ºæ—¶è‡ªåŠ¨å®‰è£…
```

## ğŸš€ å¼€å‘æ¨¡å¼

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼
pnpm tauri dev

# æˆ–ä½¿ç”¨ npm
npm run tauri dev
```

è¿™å°†ï¼š
1. å¯åŠ¨ Vite å¼€å‘æœåŠ¡å™¨ï¼ˆç«¯å£ 1420ï¼‰
2. ç¼–è¯‘ Rust åç«¯
3. å¯åŠ¨ Tauri åº”ç”¨çª—å£
4. å¯ç”¨çƒ­é‡è½½

### å¼€å‘è°ƒè¯•

```bash
# æŸ¥çœ‹ Rust æ—¥å¿—
RUST_LOG=debug pnpm tauri dev

# å‰ç«¯è°ƒè¯•
# åœ¨åº”ç”¨ä¸­æŒ‰ F12 æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ˆéœ€è¦æ³¨é‡Šæ‰ç¦ç”¨ä»£ç ï¼‰
```

## ğŸ“¦ æ„å»ºç”Ÿäº§ç‰ˆæœ¬

### 1. æ„å»ºå‰å‡†å¤‡

#### æ£€æŸ¥ç‰ˆæœ¬å·
```json
// src-tauri/tauri.conf.json
{
  "version": "0.8.0"
}

// package.json
{
  "version": "0.1.0"
}
```

#### å‡†å¤‡å›¾æ ‡
```
src-tauri/icons/
â”œâ”€â”€ 32x32.png
â”œâ”€â”€ 128x128.png
â”œâ”€â”€ 128x128@2x.png
â”œâ”€â”€ icon.icns      # macOS
â””â”€â”€ icon.ico       # Windows
```

### 2. æ„å»ºå‘½ä»¤

#### Windows
```bash
# æ„å»º Windows å®‰è£…åŒ…
pnpm tauri build

# è¾“å‡ºä½ç½®
# src-tauri/target/release/auto-cursor.exe
# src-tauri/target/release/bundle/msi/auto-cursor_0.8.0_x64_en-US.msi
```

#### macOS

##### Intel Mac
```bash
# æ„å»º x86_64 ç‰ˆæœ¬
pnpm tauri:build:intel

# æˆ–
pnpm tauri build --target x86_64-apple-darwin
```

##### Apple Silicon
```bash
# æ„å»º aarch64 ç‰ˆæœ¬
pnpm tauri:build:m1

# æˆ–
pnpm tauri build --target aarch64-apple-darwin
```

##### Universal Binaryï¼ˆæ¨èï¼‰
```bash
# æ„å»ºé€šç”¨äºŒè¿›åˆ¶ï¼ˆåŒæ—¶æ”¯æŒ Intel å’Œ Apple Siliconï¼‰
pnpm tauri:build:universal

# æˆ–
pnpm tauri build --target universal-apple-darwin
```

##### ä½¿ç”¨æ„å»ºè„šæœ¬
```bash
# ä½¿ç”¨è‡ªå®šä¹‰æ„å»ºè„šæœ¬
pnpm tauri:build:macos

# è¿™å°†æ‰§è¡Œ scripts/build-macos.sh
```

**build-macos.sh å†…å®¹**ï¼š
```bash
#!/bin/bash

echo "ğŸš€ å¼€å§‹æ„å»º macOS åº”ç”¨..."

# æ„å»º Universal Binary
echo "ğŸ“¦ æ„å»º Universal Binary..."
pnpm tauri build --target universal-apple-darwin

# æ£€æŸ¥æ„å»ºç»“æœ
if [ $? -eq 0 ]; then
    echo "âœ… æ„å»ºæˆåŠŸï¼"
    echo "ğŸ“ è¾“å‡ºä½ç½®ï¼š"
    echo "   - src-tauri/target/universal-apple-darwin/release/bundle/dmg/"
    echo "   - src-tauri/target/universal-apple-darwin/release/bundle/macos/"
else
    echo "âŒ æ„å»ºå¤±è´¥ï¼"
    exit 1
fi
```

#### Linux
```bash
# æ„å»º Linux åŒ…
pnpm tauri build

# è¾“å‡ºä½ç½®
# src-tauri/target/release/auto-cursor
# src-tauri/target/release/bundle/deb/auto-cursor_0.8.0_amd64.deb
# src-tauri/target/release/bundle/appimage/auto-cursor_0.8.0_amd64.AppImage
```

### 3. æ„å»ºè¾“å‡º

#### Windows
```
src-tauri/target/release/
â”œâ”€â”€ auto-cursor.exe                    # å¯æ‰§è¡Œæ–‡ä»¶
â””â”€â”€ bundle/
    â”œâ”€â”€ msi/
    â”‚   â””â”€â”€ auto-cursor_0.8.0_x64_en-US.msi  # MSI å®‰è£…åŒ…
    â””â”€â”€ nsis/
        â””â”€â”€ auto-cursor_0.8.0_x64-setup.exe   # NSIS å®‰è£…åŒ…
```

#### macOS
```
src-tauri/target/universal-apple-darwin/release/
â”œâ”€â”€ auto-cursor                        # å¯æ‰§è¡Œæ–‡ä»¶
â””â”€â”€ bundle/
    â”œâ”€â”€ dmg/
    â”‚   â””â”€â”€ auto-cursor_0.8.0_universal.dmg   # DMG é•œåƒ
    â””â”€â”€ macos/
        â””â”€â”€ auto-cursor.app                    # åº”ç”¨åŒ…
```

#### Linux
```
src-tauri/target/release/
â”œâ”€â”€ auto-cursor                        # å¯æ‰§è¡Œæ–‡ä»¶
â””â”€â”€ bundle/
    â”œâ”€â”€ deb/
    â”‚   â””â”€â”€ auto-cursor_0.8.0_amd64.deb       # Debian åŒ…
    â””â”€â”€ appimage/
        â””â”€â”€ auto-cursor_0.8.0_amd64.AppImage  # AppImage
```

## ğŸ”§ æ„å»ºä¼˜åŒ–

### 1. å‡å°æ–‡ä»¶å¤§å°

**Cargo.toml ä¼˜åŒ–é…ç½®**ï¼š
```toml
[profile.release]
opt-level = "z"        # ä¼˜åŒ–å¤§å°
lto = true             # é“¾æ¥æ—¶ä¼˜åŒ–
codegen-units = 1      # å•ä¸€ä»£ç ç”Ÿæˆå•å…ƒ
panic = "abort"        # ä½¿ç”¨ abort
strip = true           # å»é™¤è°ƒè¯•ç¬¦å·
```

### 2. åŠ é€Ÿæ„å»º

```bash
# ä½¿ç”¨ sccache ç¼“å­˜ç¼–è¯‘ç»“æœ
cargo install sccache
export RUSTC_WRAPPER=sccache

# å¹¶è¡Œç¼–è¯‘
export CARGO_BUILD_JOBS=8
```

### 3. æ¡ä»¶ç¼–è¯‘

```rust
// ä»…åœ¨ release æ¨¡å¼ä¸‹åŒ…å«
#[cfg(not(debug_assertions))]
fn production_only() {
    // ...
}

// ä»…åœ¨ debug æ¨¡å¼ä¸‹åŒ…å«
#[cfg(debug_assertions)]
fn debug_only() {
    // ...
}
```

## ğŸ“¤ å‘å¸ƒæµç¨‹

### 1. ç‰ˆæœ¬ç®¡ç†

#### æ›´æ–°ç‰ˆæœ¬å·
```bash
# æ›´æ–° package.json
npm version patch  # 0.1.0 -> 0.1.1
npm version minor  # 0.1.0 -> 0.2.0
npm version major  # 0.1.0 -> 1.0.0

# æ‰‹åŠ¨æ›´æ–° tauri.conf.json
# "version": "0.8.0"
```

#### åˆ›å»º Git æ ‡ç­¾
```bash
git tag -a v0.8.0 -m "Release v0.8.0"
git push origin v0.8.0
```

### 2. GitHub Releases

#### åˆ›å»º Release
```bash
# ä½¿ç”¨ GitHub CLI
gh release create v0.8.0 \
  --title "Auto-Cursor v0.8.0" \
  --notes "Release notes here" \
  src-tauri/target/release/bundle/**/*
```

#### ä¸Šä¼ è„šæœ¬ (scripts/upload.sh)
```bash
#!/bin/bash

VERSION="0.8.0"
GITHUB_REPO="username/auto-cursor"
GITHUB_TOKEN="your_token"

echo "ğŸ“¤ ä¸Šä¼  v${VERSION} åˆ° GitHub Releases..."

# Windows
gh release upload v${VERSION} \
  src-tauri/target/release/bundle/msi/*.msi

# macOS
gh release upload v${VERSION} \
  src-tauri/target/universal-apple-darwin/release/bundle/dmg/*.dmg

# Linux
gh release upload v${VERSION} \
  src-tauri/target/release/bundle/deb/*.deb \
  src-tauri/target/release/bundle/appimage/*.AppImage

echo "âœ… ä¸Šä¼ å®Œæˆï¼"
```

### 3. è‡ªåŠ¨æ›´æ–°

#### é…ç½®æ›´æ–°æœåŠ¡å™¨
```json
// tauri.conf.json
{
  "updater": {
    "active": true,
    "endpoints": [
      "https://releases.example.com/{{target}}/{{current_version}}"
    ],
    "dialog": true,
    "pubkey": "your_public_key"
  }
}
```

#### ç”Ÿæˆæ›´æ–°ç­¾å
```bash
# ç”Ÿæˆå¯†é’¥å¯¹
tauri signer generate -w ~/.tauri/myapp.key

# ç­¾åæ›´æ–°æ–‡ä»¶
tauri signer sign \
  -k ~/.tauri/myapp.key \
  src-tauri/target/release/bundle/msi/auto-cursor_0.8.0_x64_en-US.msi
```

## ğŸ³ Docker æ„å»ºï¼ˆå¯é€‰ï¼‰

### Dockerfile
```dockerfile
FROM rust:1.70 as builder

# å®‰è£… Node.js
RUN curl -fsSL https://deb.nodesource.com/setup_18.x | bash -
RUN apt-get install -y nodejs

# å®‰è£… pnpm
RUN npm install -g pnpm

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    libwebkit2gtk-4.0-dev \
    build-essential \
    curl \
    wget \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev

WORKDIR /app

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# å®‰è£…ä¾èµ–
RUN pnpm install

# æ„å»º
RUN pnpm tauri build

# è¾“å‡ºæ„å»ºäº§ç‰©
FROM scratch AS export
COPY --from=builder /app/src-tauri/target/release/bundle /
```

### ä½¿ç”¨ Docker æ„å»º
```bash
# æ„å»º
docker build -t auto-cursor-builder .

# å¯¼å‡ºæ„å»ºäº§ç‰©
docker build --output type=local,dest=./dist -f Dockerfile .
```

## ğŸ§ª æµ‹è¯•æ„å»º

### 1. æœ¬åœ°æµ‹è¯•

```bash
# æ„å»ºå¹¶è¿è¡Œ
pnpm tauri build
./src-tauri/target/release/auto-cursor

# macOS
open src-tauri/target/universal-apple-darwin/release/bundle/macos/auto-cursor.app
```

### 2. å®‰è£…æµ‹è¯•

#### Windows
```bash
# å®‰è£… MSI
msiexec /i src-tauri/target/release/bundle/msi/auto-cursor_0.8.0_x64_en-US.msi
```

#### macOS
```bash
# æŒ‚è½½ DMG
hdiutil attach src-tauri/target/universal-apple-darwin/release/bundle/dmg/auto-cursor_0.8.0_universal.dmg

# å¤åˆ¶åˆ° Applications
cp -R /Volumes/auto-cursor/auto-cursor.app /Applications/
```

#### Linux
```bash
# å®‰è£… DEB
sudo dpkg -i src-tauri/target/release/bundle/deb/auto-cursor_0.8.0_amd64.deb

# æˆ–è¿è¡Œ AppImage
chmod +x src-tauri/target/release/bundle/appimage/auto-cursor_0.8.0_amd64.AppImage
./src-tauri/target/release/bundle/appimage/auto-cursor_0.8.0_amd64.AppImage
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§æ„å»ºé”™è¯¯

#### 1. Rust ç¼–è¯‘é”™è¯¯
```bash
# æ¸…ç†æ„å»ºç¼“å­˜
cargo clean

# æ›´æ–° Rust
rustup update

# é‡æ–°æ„å»º
pnpm tauri build
```

#### 2. Node æ¨¡å—é”™è¯¯
```bash
# åˆ é™¤ node_modules
rm -rf node_modules

# æ¸…ç†ç¼“å­˜
pnpm store prune

# é‡æ–°å®‰è£…
pnpm install
```

#### 3. macOS ç­¾åé—®é¢˜
```bash
# ä¸´æ—¶ç¦ç”¨ç­¾åéªŒè¯ï¼ˆä»…ç”¨äºå¼€å‘ï¼‰
sudo spctl --master-disable

# ç­¾ååº”ç”¨
codesign --force --deep --sign - auto-cursor.app
```

#### 4. Linux ä¾èµ–ç¼ºå¤±
```bash
# Ubuntu/Debian
sudo apt-get install -y \
    libwebkit2gtk-4.0-dev \
    build-essential \
    curl \
    wget \
    libssl-dev \
    libgtk-3-dev \
    libayatana-appindicator3-dev \
    librsvg2-dev

# Fedora
sudo dnf install -y \
    webkit2gtk3-devel \
    openssl-devel \
    curl \
    wget \
    gtk3-devel \
    librsvg2-devel
```

## ğŸ“Š æ„å»ºæ€§èƒ½

### æ„å»ºæ—¶é—´å‚è€ƒ

| å¹³å° | é…ç½® | é¦–æ¬¡æ„å»º | å¢é‡æ„å»º |
|------|------|----------|----------|
| Windows | i7-10700, 16GB RAM | ~15åˆ†é’Ÿ | ~3åˆ†é’Ÿ |
| macOS Intel | i9-9900K, 32GB RAM | ~12åˆ†é’Ÿ | ~2åˆ†é’Ÿ |
| macOS M1 | M1 Pro, 16GB RAM | ~8åˆ†é’Ÿ | ~1åˆ†é’Ÿ |
| Linux | Ryzen 7 5800X, 32GB RAM | ~10åˆ†é’Ÿ | ~2åˆ†é’Ÿ |

### ä¼˜åŒ–å»ºè®®

1. **ä½¿ç”¨ SSD**ï¼šæ˜¾è‘—æå‡ç¼–è¯‘é€Ÿåº¦
2. **å¢åŠ å†…å­˜**ï¼šè‡³å°‘ 16GB
3. **ä½¿ç”¨ç¼“å­˜**ï¼šsccache æˆ– mold
4. **å¹¶è¡Œç¼–è¯‘**ï¼šè®¾ç½® CARGO_BUILD_JOBS
5. **å¢é‡ç¼–è¯‘**ï¼šé¿å… cargo clean

## ğŸ“ æ£€æŸ¥æ¸…å•

### å‘å¸ƒå‰æ£€æŸ¥

- [ ] æ›´æ–°ç‰ˆæœ¬å·
- [ ] æ›´æ–° CHANGELOG
- [ ] æµ‹è¯•æ‰€æœ‰åŠŸèƒ½
- [ ] æ£€æŸ¥æ—¥å¿—è¾“å‡º
- [ ] æµ‹è¯•æ›´æ–°åŠŸèƒ½
- [ ] å‡†å¤‡å‘å¸ƒè¯´æ˜
- [ ] åˆ›å»º Git æ ‡ç­¾
- [ ] æ„å»ºæ‰€æœ‰å¹³å°
- [ ] æµ‹è¯•å®‰è£…åŒ…
- [ ] ä¸Šä¼ åˆ° GitHub Releases
- [ ] æ›´æ–°æ–‡æ¡£

---

**æœ€åæ›´æ–°**ï¼š2025-10-28
**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0.0

